!function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t,e){"use strict";function n(t,e,n){var i=e.toString();(angular.isNumber(n)||!isFinite(n)||Math.floor(n)!==n||n>i.length)&&(n=i.length),n-=t.length;var r=i.indexOf(t,n);return-1!==r&&r===n}function i(t,e,n){return n=n||0,e.indexOf(t,n)===n}t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&a.hasOwnProperty(t)?r+"/"+a[t]:r}var r="https://example.com/",a={service:"service",token:"token/new"},u="",c=3,s=!1,o=!1,f=25,h=[];this.setAuthenticationApiBaseUrl=function(t){return r=n("/",t)?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return u=t,this};var d=this.addManagedApi=function(t){var e=angular.isString(t)?[t]:t;return angular.forEach(e,function(t){-1===this.indexOf(t)&&this.push(t)},h),this};this.setRequireAccessToken=function(t){return s=!!t,this},this.setCacheAccessToken=function(t){return o=angular.isUndefined(e)?!1:!!t,this},this.$get=["$injector","$q",function(n,r){function a(t){for(var e=0;e<h.length;e++)if(i(h[e],t))return!0;return!1}function l(){angular.isObject(A)||(A=r.defer(),k=void 0,o&&e.remove("access_token"),n.get("$http").get(t("service")).then(function(e){n.get("$http").get(u,{params:{service:e.data.data.id}}).then(function(e){n.get("$http").get(t("token"),{params:{st:e.data.data.id}}).then(function(t){k=t.data.data.id,A.resolve()},function(){A.reject("Failed to fetch token.")})},function(){A.reject("Failed to fetch ticket.")})},function(){A.reject("Failed to fetch service.")}))}function g(n){if(n.url===t("service")||n.url===t("token"))return n;if(a(n.url)){if(angular.isUndefined(k)&&o){var i=e.get("access_token");null!==i&&(k=i)}if(n.attempts="number"==typeof n.attempts?n.attempts+1:1,s&&angular.isUndefined(k)||angular.isObject(A))return p(n);angular.isDefined(k)&&(n.headers.Authorization="Bearer "+k)}return n}function p(t){var e=r.defer();return l(),A.promise.then(function(){t.headers.Authorization="Bearer "+k,e.resolve(t)},function(){e.reject()}),e.promise}function v(t){return a(t.config.url)&&angular.isDefined(k)&&o&&e.set("access_token",k,f),t}function m(t){if(401===t.status&&a(t.config.url)&&t.config.attempts<c){var e=r.defer();return l(),A.promise.then(function(){n.get("$http")(t.config).then(function(t){e.resolve(t)},function(){e.reject()})},function(){e.reject()}),e.promise}return r.reject(t)}var k,A;return{request:g,response:v,responseError:m,addManagedApi:d}}]})}(angular.module("cas-auth-api"),window.lscache),function(t,e){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}]),t.run(function(){angular.isDefined(e)&&e.setBucket("cas-auth-api:")})}(angular.module("cas-auth-api"),window.lscache);