!function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t,e){"use strict";function n(t,e,n){var i=e.toString();(angular.isNumber(n)||!isFinite(n)||Math.floor(n)!==n||n>i.length)&&(n=i.length),n-=t.length;var r=i.indexOf(t,n);return-1!==r&&r===n}function i(t,e,n){return n=n||0,e.indexOf(t,n)===n}t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&u.hasOwnProperty(t)?a+"/"+u[t]:a}var r,a="https://example.com/",u={service:"service",token:"token/new"},c="",s=3,o=!1,f=!1,h=25,d=[];this.setAuthenticationApiBaseUrl=function(t){return a=n("/",t)?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return c=t,this};var l=this.addManagedApi=function(t){var e=angular.isString(t)?[t]:t;return angular.forEach(e,function(t){-1===this.indexOf(t)&&this.push(t)},d),this};this.setRequireAccessToken=function(t){return o=!!t,this},this.setCacheAccessToken=function(t){return f=angular.isUndefined(e)?!1:!!t,this},this.setErrorCallback=function(t){return r=angular.isFunction(t)?t:void 0,this},this.$get=["$injector","$q",function(n,a){function u(t){for(var e=0;e<d.length;e++)if(i(d[e],t))return!0;return!1}function g(){angular.isObject(w)||(w=a.defer(),j=void 0,f&&e.remove("access_token"),n.get("$http").get(t("service")).then(function(e){n.get("$http").get(c,{params:{service:e.data.data.id}}).then(function(e){n.get("$http").get(t("token"),{params:{st:e.data.data.id}}).then(function(t){j=t.data.data.id,w.resolve()},function(){w.reject("Failed to fetch token.")})},function(){angular.isFunction(r)&&r({code:"ERR_TICKET",message:"Failed to fetch ticket."}),w.reject("Failed to fetch ticket.")})},function(){w.reject("Failed to fetch service.")}))}function p(n){if(n.url===t("service")||n.url===t("token"))return n;if(u(n.url)){if(angular.isUndefined(j)&&f){var i=e.get("access_token");null!==i&&(j=i)}if(n.attempts="number"==typeof n.attempts?n.attempts+1:1,o&&angular.isUndefined(j)||angular.isObject(w))return v(n);angular.isDefined(j)&&(n.headers.Authorization="Bearer "+j)}return n}function v(t){var e=a.defer();return g(),w.promise.then(function(){t.headers.Authorization="Bearer "+j,e.resolve(t)},function(){e.reject()}),e.promise}function m(t){return u(t.config.url)&&angular.isDefined(j)&&f&&e.set("access_token",j,h),t}function k(t){if(u(t.config.url)&&A(t)&&t.config.attempts<s){var e=a.defer();return g(),w.promise.then(function(){n.get("$http")(t.config).then(function(t){e.resolve(t)},function(){e.reject()})},function(){e.reject()}),e.promise}return a.reject(t)}function A(t){var e=t.headers("WWW-Authenticate");return 401===t.status&&e&&i("CAS",e)}var j,w;return{request:p,response:m,responseError:k,addManagedApi:l}}]})}(angular.module("cas-auth-api"),window.lscache),function(t,e){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}]),t.run(function(){angular.isDefined(e)&&e.setBucket("cas-auth-api:")})}(angular.module("cas-auth-api"),window.lscache);