!function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t){"use strict";function e(t,e,n){var r=e.toString();(angular.isNumber(n)||!isFinite(n)||Math.floor(n)!==n||n>r.length)&&(n=r.length),n-=t.length;var i=r.indexOf(t,n);return-1!==i&&i===n}function n(t,e,n){return n=n||0,e.indexOf(t,n)===n}t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&i.hasOwnProperty(t)?r+"/"+i[t]:r}var r="https://example.com/",i={service:"service",token:"token/new"},u="",a=3,o=!1,c=[];this.setAuthenticationApiBaseUrl=function(t){return r=e("/",t)?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return u=t,this};var s=this.addManagedApi=function(t){var e=angular.isString(t)?[t]:t;return angular.forEach(e,function(t){-1===this.indexOf(t)&&this.push(t)},c),this};this.setRequireAccessToken=function(t){return o=!!t,this},this.$get=["$injector","$q",function(e,r){function i(t){for(var e=0;e<c.length;e++)if(n(c[e],t))return!0;return!1}function f(){angular.isObject(g)||(g=r.defer(),l=void 0,e.get("$http").get(t("service")).then(function(n){e.get("$http").get(u,{params:{service:n.data.data.id}}).then(function(n){e.get("$http").get(t("token"),{params:{st:n.data.data.id}}).then(function(t){l=t.data.data.id,g.resolve()},function(){g.reject("Failed to fetch token.")})},function(){g.reject("Failed to fetch ticket.")})},function(){g.reject("Failed to fetch service.")}))}function h(e){if(e.url===t("service")||e.url===t("token"))return e;if(i(e.url)){if(e.attempts="number"==typeof e.attempts?e.attempts+1:1,o&&angular.isUndefined(l)||angular.isObject(g))return d(e);angular.isDefined(l)&&(e.headers.Authorization="Bearer "+l)}return e}function d(t){var e=r.defer();return f(),g.promise.then(function(){t.headers.Authorization="Bearer "+l,e.resolve(t)},function(){e.reject()}),e.promise}function p(t){if(401===t.status&&i(t.config.url)&&t.config.attempts<a){var n=r.defer();return f(),g.promise.then(function(){e.get("$http")(t.config).then(function(t){n.resolve(t)},function(){n.reject()})},function(){n.reject()}),n.promise}return r.reject(t)}var l,g;return{request:h,responseError:p,addManagedApi:s}}]})}(angular.module("cas-auth-api")),function(t){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}])}(angular.module("cas-auth-api"));