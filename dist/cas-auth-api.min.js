String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var r=n.indexOf(t,e);return-1!==r&&r===e}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e}),function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t){"use strict";t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&n.hasOwnProperty(t)?e+"/"+n[t]:e}var e="https://example.com/",n={service:"service",token:"token/new"},r="",i=3,o=[];this.setAuthenticationApiBaseUrl=function(t){return e=t.endsWith("/")?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return r=t,this};var a=this.addManagedApi=function(t){return-1===o.indexOf(t)&&o.push(t),this};this.$get=["$injector","$q",function(e,n){function u(t){for(var e=0;e<o.length;e++)if(t.startsWith(o[e]))return!0;return!1}function s(e){return e.url===t("service")||e.url===t("token")?e:(u(e.url)&&("undefined"!=typeof f&&(e.headers.Authorization="Bearer "+f),e.attempts="number"==typeof e.attempts?e.attempts+1:1),e)}function c(o){if(401===o.status&&u(o.config.url)&&o.config.attempts<i){var a=n.defer();return"object"!=typeof h&&(h=n.defer(),e.get("$http").get(t("service")).then(function(n){e.get("$http").get(r,{params:{service:n.data.data.id}}).then(function(n){e.get("$http").get(t("token"),{params:{st:n.data.data.id}}).then(function(t){f=t.data.data.id,h.resolve()},function(){h.reject("Failed to fetch token.")})},function(){h.reject("Failed to fetch ticket.")})},function(){h.reject("Failed to fetch service.")})),h.promise.then(function(){e.get("$http")(o.config).then(function(t){a.resolve(t)},function(){a.reject()})},function(t){a.reject()}),a.promise}return n.reject(o)}var f,h;return{request:s,responseError:c,addManagedApi:a}}]})}(angular.module("cas-auth-api")),function(t){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}])}(angular.module("cas-auth-api"));