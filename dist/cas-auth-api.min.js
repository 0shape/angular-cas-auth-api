!function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t){"use strict";function e(t,e,n){var r=e.toString();(angular.isNumber(n)||!isFinite(n)||Math.floor(n)!==n||n>r.length)&&(n=r.length),n-=t.length;var i=r.indexOf(t,n);return-1!==i&&i===n}function n(t,e,n){return n=n||0,e.indexOf(t,n)===n}t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&i.hasOwnProperty(t)?r+"/"+i[t]:r}var r="https://example.com/",i={service:"service",token:"token/new"},u="",o=3,a=[];this.setAuthenticationApiBaseUrl=function(t){return r=e("/",t)?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return u=t,this};var c=this.addManagedApi=function(t){return-1===a.indexOf(t)&&a.push(t),this};this.$get=["$injector","$q",function(e,r){function i(t){for(var e=0;e<a.length;e++)if(n(a[e],t))return!0;return!1}function s(e){return e.url===t("service")||e.url===t("token")?e:(i(e.url)&&("undefined"!=typeof h&&(e.headers.Authorization="Bearer "+h),e.attempts="number"==typeof e.attempts?e.attempts+1:1),e)}function f(n){if(401===n.status&&i(n.config.url)&&n.config.attempts<o){var a=r.defer();return"object"!=typeof d&&(d=r.defer(),e.get("$http").get(t("service")).then(function(n){e.get("$http").get(u,{params:{service:n.data.data.id}}).then(function(n){e.get("$http").get(t("token"),{params:{st:n.data.data.id}}).then(function(t){h=t.data.data.id,d.resolve()},function(){d.reject("Failed to fetch token.")})},function(){d.reject("Failed to fetch ticket.")})},function(){d.reject("Failed to fetch service.")})),d.promise.then(function(){e.get("$http")(n.config).then(function(t){a.resolve(t)},function(){a.reject()})},function(){a.reject()}),a.promise}return r.reject(n)}var h,d;return{request:s,responseError:f,addManagedApi:c}}]})}(angular.module("cas-auth-api")),function(t){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}])}(angular.module("cas-auth-api"));