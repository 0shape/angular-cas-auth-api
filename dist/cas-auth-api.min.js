!function(t){"use strict";t.module("cas-auth-api",[])}(window.angular),function(t,e){"use strict";function n(t,e,n){var i=e.toString();(angular.isNumber(n)||!isFinite(n)||Math.floor(n)!==n||n>i.length)&&(n=i.length),n-=t.length;var r=i.indexOf(t,n);return-1!==r&&r===n}function i(t,e,n){return n=n||0,e.indexOf(t,n)===n}t.provider("casAuthApi",function(){function t(t){return"undefined"!=typeof t&&a.hasOwnProperty(t)?r+"/"+a[t]:r}var r="https://example.com/",a={service:"service",token:"token/new"},u="",c=3,s=!1,o=!1,f=[];this.setAuthenticationApiBaseUrl=function(t){return r=n("/",t)?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return u=t,this};var h=this.addManagedApi=function(t){var e=angular.isString(t)?[t]:t;return angular.forEach(e,function(t){-1===this.indexOf(t)&&this.push(t)},f),this};this.setRequireAccessToken=function(t){return s=!!t,this},this.setCacheAccessToken=function(t){return o=angular.isUndefined(e)?!1:!!t,this},this.$get=["$injector","$q",function(n,r){function a(t){for(var e=0;e<f.length;e++)if(i(f[e],t))return!0;return!1}function d(){angular.isObject(k)||(k=r.defer(),m=void 0,o&&e.remove("access_token"),n.get("$http").get(t("service")).then(function(e){n.get("$http").get(u,{params:{service:e.data.data.id}}).then(function(e){n.get("$http").get(t("token"),{params:{st:e.data.data.id}}).then(function(t){m=t.data.data.id,k.resolve()},function(){k.reject("Failed to fetch token.")})},function(){k.reject("Failed to fetch ticket.")})},function(){k.reject("Failed to fetch service.")}))}function l(n){if(n.url===t("service")||n.url===t("token"))return n;if(a(n.url)){if(angular.isUndefined(m)&&o){var i=e.get("access_token");null!==i&&(m=i)}if(n.attempts="number"==typeof n.attempts?n.attempts+1:1,s&&angular.isUndefined(m)||angular.isObject(k))return g(n);angular.isDefined(m)&&(n.headers.Authorization="Bearer "+m)}return n}function g(t){var e=r.defer();return d(),k.promise.then(function(){t.headers.Authorization="Bearer "+m,e.resolve(t)},function(){e.reject()}),e.promise}function p(t){return a(t.config.url)&&angular.isDefined(m)&&o&&e.set("access_token",m,15),t}function v(t){if(401===t.status&&a(t.config.url)&&t.config.attempts<c){var e=r.defer();return d(),k.promise.then(function(){n.get("$http")(t.config).then(function(t){e.resolve(t)},function(){e.reject()})},function(){e.reject()}),e.promise}return r.reject(t)}var m,k;return{request:l,response:p,responseError:v,addManagedApi:h}}]})}(angular.module("cas-auth-api"),window.lscache),function(t,e){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthApi")}]),t.run(function(){angular.isDefined(e)&&e.setBucket("cas-auth-api:")})}(angular.module("cas-auth-api"),window.lscache);