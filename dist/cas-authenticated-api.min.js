String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var i=n.indexOf(t,e);return-1!==i&&i===e}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e}),function(t){"use strict";t.module("cas-authenticated-api",[])}(window.angular),function(t){"use strict";t.provider("casAuthenticatedApi",function(){function t(t){return"undefined"!=typeof t&&n.hasOwnProperty(t)?e+"/"+n[t]:e}var e="https://example.com/",n={service:"authz/service",token:"authz/token"},i="",r=3,o=[];this.setAuthenticationApiBaseUrl=function(t){return e=t.endsWith("/")?t.slice(0,-1):t,this},this.setTicketUrl=function(t){return i=t,this};var a=this.addManagedApi=function(t){return-1===o.indexOf(t)&&o.push(t),this};this.$get=["$injector","$q",function(e,n){function c(t){for(var e=0;e<o.length;e++)if(t.startsWith(o[e]))return!0;return!1}function u(e){return e.url===t("service")||e.url===t("token")?e:(c(e.url)&&("undefined"!=typeof f&&(e.headers.Authorization="Bearer "+f),e.attempts="number"==typeof e.attempts?e.attempts+1:1),e)}function s(o){if(401===o.status&&c(o.config.url)&&o.config.attempts<r){var a=n.defer();return"object"!=typeof h&&(h=n.defer(),e.get("$http").get(t("service")).then(function(n){e.get("$http").get(i,{params:{service:n.data.service}}).then(function(n){e.get("$http").get(t("token"),{params:{st:n.data.service_ticket}}).then(function(t){f=t.data.data.id,h.resolve()},function(){h.reject("Failed to fetch token.")})},function(){h.reject("Failed to fetch ticket.")})},function(){h.reject("Failed to fetch service.")})),h.promise.then(function(){e.get("$http")(o.config).then(function(t){a.resolve(t)},function(){a.reject()})},function(t){a.reject()}),a.promise}return n.reject(o)}var f,h;return{request:u,responseError:s,addManagedApi:a}}]})}(angular.module("cas-authenticated-api")),function(t){"use strict";t.config(["$httpProvider",function(t){t.interceptors.push("casAuthenticatedApi")}])}(angular.module("cas-authenticated-api"));